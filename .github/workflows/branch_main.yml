on:
  push:
    branches:
      - "main"

name: "Main Branch"

jobs:
  test:
    name: "Test"
    
    uses: matchd-ch/matchd-backend/.github/workflows/part_test.yml@main
  
  build:
    name: "Build"

    uses: matchd-ch/matchd-backend/.github/workflows/part_build.yml@main

  deploy:
    name: "Deploy"

    needs: ['build']

    uses: matchd-ch/matchd-backend/.github/workflows/part_deploy.yml@main
    with:
      namespace: matchd-backend-development
      release: matchd-backend
      environment: development
      domain: development-matchd-backend.joshmartin.ch
      dbHost: 10.100.35.5
      dbUser: matchd-development
      dbName: matchd-development
      senderEmail: info@matchd.ch
      smtpRelay: smtp.postmarkapp.com
      smtpPort: 2525
      emailSubjectPrefix: '[DEV]'
      frontendUrl: https://development-matchd-frontend.joshmartin.ch
      csrfCookieDomain: '.joshmartin.ch'
      dataProtectionUrl: 'https://example.com'
      resetDb: false
    secrets:
      DOCKER_PULL_USERNAME: ${{ secrets.DOCKER_PULL_USERNAME }}
      DOCKER_PULL_SECRET: ${{ secrets.DOCKER_PULL_SECRET }}
      DB_PASSWORD: ${{ secrets.DEVELOPMENT_DB_PASSWORD }}
      SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
      SMTP_USER: ${{ secrets.SMTP_USER }}
      SECRET_KEY: ${{ secrets.DEVELOPMENT_SECRET_KEY }}